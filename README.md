# Image Captcha Recognition API

## Packages

[![absl-py](https://img.shields.io/badge/absl--py-2.1.0-blue)](https://pypi.org/project/absl-py/)
[![annotated-types](https://img.shields.io/badge/annotated--types-0.6.0-blue)](https://pypi.org/project/annotated-types/)
[![anyio](https://img.shields.io/badge/anyio-4.3.0-blue)](https://pypi.org/project/anyio/)
[![asttokens](https://img.shields.io/badge/asttokens-2.4.1-blue)](https://pypi.org/project/asttokens/)
[![astunparse](https://img.shields.io/badge/astunparse-1.6.3-blue)](https://pypi.org/project/astunparse/)
[![certifi](https://img.shields.io/badge/certifi-2024.2.2-blue)](https://pypi.org/project/certifi/)
[![charset-normalizer](https://img.shields.io/badge/charset--normalizer-3.3.2-blue)](https://pypi.org/project/charset-normalizer/)
[![click](https://img.shields.io/badge/click-8.1.7-blue)](https://pypi.org/project/click/)
[![colorama](https://img.shields.io/badge/colorama-0.4.6-blue)](https://pypi.org/project/colorama/)
[![comm](https://img.shields.io/badge/comm-0.2.2-blue)](https://pypi.org/project/comm/)
[![debugpy](https://img.shields.io/badge/debugpy-1.8.1-blue)](https://pypi.org/project/debugpy/)
[![decorator](https://img.shields.io/badge/decorator-5.1.1-blue)](https://pypi.org/project/decorator/)
[![exceptiongroup](https://img.shields.io/badge/exceptiongroup-1.2.1-blue)](https://pypi.org/project/exceptiongroup/)
[![executing](https://img.shields.io/badge/executing-2.0.1-blue)](https://pypi.org/project/executing/)
[![fastapi](https://img.shields.io/badge/fastapi-0.110.2-blue)](https://pypi.org/project/fastapi/)
[![flatbuffers](https://img.shields.io/badge/flatbuffers-24.3.25-blue)](https://pypi.org/project/flatbuffers/)
[![gast](https://img.shields.io/badge/gast-0.5.4-blue)](https://pypi.org/project/gast/)
[![google-pasta](https://img.shields.io/badge/google--pasta-0.2.0-blue)](https://pypi.org/project/google-pasta/)
[![greenlet](https://img.shields.io/badge/greenlet-3.0.3-blue)](https://pypi.org/project/greenlet/)
[![grpcio](https://img.shields.io/badge/grpcio-1.62.2-blue)](https://pypi.org/project/grpcio/)
[![h11](https://img.shields.io/badge/h11-0.14.0-blue)](https://pypi.org/project/h11/)
[![h5py](https://img.shields.io/badge/h5py-3.11.0-blue)](https://pypi.org/project/h5py/)
[![idna](https://img.shields.io/badge/idna-3.7-blue)](https://pypi.org/project/idna/)
[![ipykernel](https://img.shields.io/badge/ipykernel-6.29.4-blue)](https://pypi.org/project/ipykernel/)
[![ipython](https://img.shields.io/badge/ipython-8.23.0-blue)](https://pypi.org/project/ipython/)
[![jedi](https://img.shields.io/badge/jedi-0.19.1-blue)](https://pypi.org/project/jedi/)
[![joblib](https://img.shields.io/badge/joblib-1.4.0-blue)](https://pypi.org/project/joblib/)
[![jupyter_client](https://img.shields.io/badge/jupyter__client-8.6.1-blue)](https://pypi.org/project/jupyter-client/)
[![jupyter_core](https://img.shields.io/badge/jupyter__core-5.7.2-blue)](https://pypi.org/project/jupyter-core/)
[![keras](https://img.shields.io/badge/keras-2.15.0-blue)](https://pypi.org/project/keras/)
[![libclang](https://img.shields.io/badge/libclang-18.1.1-blue)](https://pypi.org/project/libclang/)
[![Markdown](https://img.shields.io/badge/Markdown-3.6-blue)](https://pypi.org/project/Markdown/)
[![markdown-it-py](https://img.shields.io/badge/markdown--it--py-3.0.0-blue)](https://pypi.org/project/markdown-it-py/)
[![MarkupSafe](https://img.shields.io/badge/MarkupSafe-2.1.5-blue)](https://pypi.org/project/MarkupSafe/)
[![matplotlib](https://img.shields.io/badge/matplotlib-3.8.4-blue)](https://pypi.org/project/matplotlib/)
[![matplotlib-inline](https://img.shields.io/badge/matplotlib--inline-0.1.7-blue)](https://pypi.org/project/matplotlib-inline/)
[![mdurl](https://img.shields.io/badge/mdurl-0.1.2-blue)](https://pypi.org/project/mdurl/)
[![ml-dtypes](https://img.shields.io/badge/ml--dtypes-0.3.2-blue)](https://pypi.org/project/ml-dtypes/)
[![namex](https://img.shields.io/badge/namex-0.0.8-blue)](https://pypi.org/project/namex/)
[![nest-asyncio](https://img.shields.io/badge/nest--asyncio-1.6.0-blue)](https://pypi.org/project/nest-asyncio/)
[![numpy](https://img.shields.io/badge/numpy-1.26.4-blue)](https://pypi.org/project/numpy/)
[![oauthlib](https://img.shields.io/badge/oauthlib-3.2.2-blue)](https://pypi.org/project/oauthlib/)
[![opencv-python](https://img.shields.io/badge/opencv--python-4.9.0.80-blue)](https://pypi.org/project/opencv-python/)
[![opt-einsum](https://img.shields.io/badge/opt--einsum-3.3.0-blue)](https://pypi.org/project/opt-einsum/)
[![optree](https://img.shields.io/badge/optree-0.11.0-blue)](https://pypi.org/project/optree/)
[![packaging](https://img.shields.io/badge/packaging-24.0-blue)](https://pypi.org/project/packaging/)
[![pandas](https://img.shields.io/badge/pandas-2.2.2-blue)](https://pypi.org/project/pandas/)
[![parso](https://img.shields.io/badge/parso-0.8.4-blue)](https://pypi.org/project/parso/)
[![pillow](https://img.shields.io/badge/pillow-10.3.0-blue)](https://pypi.org/project/pillow/)
[![prompt-toolkit](https://img.shields.io/badge/prompt--toolkit-3.0.43-blue)](https://pypi.org/project/prompt-toolkit/)
[![protobuf](https://img.shields.io/badge/protobuf-4.25.3-blue)](https://pypi.org/project/protobuf/)
[![psutil](https://img.shields.io/badge/psutil-5.9.8-blue)](https://pypi.org/project/psutil/)
[![pure-eval](https://img.shields.io/badge/pure--eval-0.2.2-blue)](https://pypi.org/project/pure-eval/)
[![pyasn1](https://img.shields.io/badge/pyasn1-0.6.0-blue)](https://pypi.org/project/pyasn1/)
[![pyasn1-modules](https://img.shields.io/badge/pyasn1__modules-0.4.0-blue)](https://pypi.org/project/pyasn1-modules/)
[![pydantic](https://img.shields.io/badge/pydantic-2.7.0-blue)](https://pypi.org/project/pydantic/)
[![pydantic-core](https://img.shields.io/badge/pydantic__core-2.18.1-blue)](https://pypi.org/project/pydantic-core/)
[![Pygments](https://img.shields.io/badge/Pygments-2.17.2-blue)](https://pypi.org/project/Pygments/)
[![pyparsing](https://img.shields.io/badge/pyparsing-3.1.2-blue)](https://pypi.org/project/pyparsing/)
[![python-dateutil](https://img.shields.io/badge/python--dateutil-2.9.0.post0-blue)](https://pypi.org/project/python-dateutil/)
[![python-multipart](https://img.shields.io/badge/python--multipart-0.0.9-blue)](https://pypi.org/project/python-multipart/)
[![pytz](https://img.shields.io/badge/pytz-2024.1-blue)](https://pypi.org/project/pytz/)
[![pywin32](https://img.shields.io/badge/pywin32-306-blue)](https://pypi.org/project/pywin32/)
[![pyzmq](https://img.shields.io/badge/pyzmq-26.0.2-blue)](https://pypi.org/project/pyzmq/)
[![requests](https://img.shields.io/badge/requests-2.31.0-blue)](https://pypi.org/project/requests/)
[![requests-oauthlib](https://img.shields.io/badge/requests--oauthlib-2.0.0-blue)](https://pypi.org/project/requests-oauthlib/)
[![rich](https://img.shields.io/badge/rich-13.7.1-blue)](https://pypi.org/project/rich/)
[![rsa](https://img.shields.io/badge/rsa-4.9-blue)](https://pypi.org/project/rsa/)
[![scikit-learn](https://img.shields.io/badge/scikit--learn-1.4.2-blue)](https://pypi.org/project/scikit-learn/)
[![scipy](https://img.shields.io/badge/scipy-1.13.0-blue)](https://pypi.org/project/scipy/)
[![six](https://img.shields.io/badge/six-1.16.0-blue)](https://pypi.org/project/six/)
[![sniffio](https://img.shields.io/badge/sniffio-1.3.1-blue)](https://pypi.org/project/sniffio/)
[![SQLAlchemy](https://img.shields.io/badge/SQLAlchemy-2.0.29-blue)](https://pypi.org/project/SQLAlchemy/)
[![stack-data](https://img.shields.io/badge/stack--data-0.6.3-blue)](https://pypi.org/project/stack-data/)
[![starlette](https://img.shields.io/badge/starlette-0.37.2-blue)](https://pypi.org/project/starlette/)
[![tensorboard](https://img.shields.io/badge/tensorboard-2.15.2-blue)](https://pypi.org/project/tensorboard/)
[![tensorboard-data-server](https://img.shields.io/badge/tensorboard--data--server-0.7.2-blue)](https://pypi.org/project/tensorboard-data-server/)
[![tensorflow](https://img.shields.io/badge/tensorflow-2.15.1-blue)](https://pypi.org/project/tensorflow/)
[![tensorflow-estimator](https://img.shields.io/badge/tensorflow--estimator-2.15.0-blue)](https://pypi.org/project/tensorflow-estimator/)
[![tensorflow-intel](https://img.shields.io/badge/tensorflow--intel-2.15.1-blue)](https://pypi.org/project/tensorflow-intel/)
[![tensorflow-io-gcs-filesystem](https://img.shields.io/badge/tensorflow--io--gcs--filesystem-0.31.0-blue)](https://pypi.org/project/tensorflow-io-gcs-filesystem/)
[![termcolor](https://img.shields.io/badge/termcolor-2.4.0-blue)](https://pypi.org/project/termcolor/)
[![threadpoolctl](https://img.shields.io/badge/threadpoolctl-3.4.0-blue)](https://pypi.org/project/threadpoolctl/)
[![tornado](https://img.shields.io/badge/tornado-6.4-blue)](https://pypi.org/project/tornado/)
[![traitlets](https://img.shields.io/badge/traitlets-5.14.3-blue)](https://pypi.org/project/traitlets/)
[![typing-extensions](https://img.shields.io/badge/typing__extensions-4.11.0-blue)](https://pypi.org/project/typing-extensions/)
[![tzdata](https://img.shields.io/badge/tzdata-2024.1-blue)](https://pypi.org/project/tzdata/)
[![urllib3](https://img.shields.io/badge/urllib3-2.2.1-blue)](https://pypi.org/project/urllib3/)
[![uvicorn](https://img.shields.io/badge/uvicorn-0.29.0-blue)](https://pypi.org/project/uvicorn/)
[![wcwidth](https://img.shields.io/badge/wcwidth-0.2.13-blue)](https://pypi.org/project/wcwidth/)
[![Werkzeug](https://img.shields.io/badge/Werkzeug-3.0.2-blue)](https://pypi.org/project/Werkzeug/)
[![wrapt](https://img.shields.io/badge/wrapt-1.14.1-blue)](https://pypi.org/project/wrapt/)

## Sum√°rio

- [Image Captcha Recognition API](#image-captcha-recognition-api) üñºÔ∏è
  - [Treinamento do Modelo de Reconhecimento de Captcha](#treinamento-do-modelo-de-reconhecimento-de-captcha) üß†
  - [Pr√©-processamento de Dados](#pr√©-processamento-de-dados) üõ†Ô∏è
    - [Carregamento das Imagens](#carregamento-das-imagens) üì∑
    - [Prepara√ß√£o das Solu√ß√µes](#prepara√ß√£o-das-solu√ß√µes) üìù
    - [Divis√£o do Conjunto de Dados](#divis√£o-do-conjunto-de-dados) üìä
  - [Arquitetura do Modelo](#arquitetura-do-modelo) üèóÔ∏è
  - [Treinamento do Modelo](#treinamento-do-modelo) üéì
  - [Avalia√ß√£o do Modelo](#avalia√ß√£o-do-modelo) üìä
  - [Resultados](#resultados) üìà
  - [API de Reconhecimento de Captchas](#api-de-reconhecimento-de-captchas) üåê
  - [Requisitos](#requisitos) üìã
  - [Instala√ß√£o](#instala√ß√£o) üíª
    - [Vers√£o do Python](#vers√£o-do-python) ‚öôÔ∏è
    - [Clone este reposit√≥rio em sua m√°quina local](#clone-este-reposit√≥rio-em-sua-m√°quina-local) üîÑ
    - [Navegue at√© o diret√≥rio do projeto](#navegue-at√©-o-diret√≥rio-do-projeto) üìÅ
    - [Instale as depend√™ncias usando pip](#instale-as-depend√™ncias-usando-pip) ‚öôÔ∏è
  - [Como Rodar](#como-rodar) üèÉ‚Äç‚ôÇÔ∏è
    - [Ap√≥s instalar as depend√™ncias, voc√™ pode iniciar o servidor da API usando o seguinte comando](#ap√≥s-instalar-as-depend√™ncias-voc√™-pode-iniciar-o-servidor-da-api-usando-o-seguinte-comando) ‚ñ∂Ô∏è

## Treinamento do Modelo de Reconhecimento de Captcha

Este projeto consiste no treinamento de um modelo de rede neural convolucional (CNN) para reconhecer e classificar caracteres em imagens de captcha.

## Pr√©-processamento de Dados

### Carregamento das Imagens

As imagens de captcha s√£o carregadas e pr√©-processadas da seguinte maneira:

- As imagens s√£o carregadas do caminho especificado no DataFrame.
- Cada imagem √© redimensionada para uma altura e largura padr√£o de 200x50 pixels.
- Os valores dos pixels s√£o normalizados para o intervalo [0, 1].

### Prepara√ß√£o das Solu√ß√µes

As solu√ß√µes de cada captcha s√£o preparadas da seguinte forma:

- Cada solu√ß√£o (texto) √© convertida em uma lista de caracteres.
- Um conjunto √∫nico de caracteres √© criado para determinar o n√∫mero de classes.
- Cada caractere √© mapeado para um n√∫mero inteiro usando um dicion√°rio.

### Divis√£o do Conjunto de Dados

O conjunto de dados √© dividido em conjuntos de treinamento e teste usando uma propor√ß√£o de 80/20.

## Arquitetura do Modelo

O modelo de reconhecimento de captcha utiliza uma arquitetura de rede neural convolucional (CNN) seguida por camadas de redes neurais recorrentes (RNN). Aqui est√° a descri√ß√£o da arquitetura:

1. **Camadas Convolucionais:** O modelo come√ßa com duas camadas convolucionais, cada uma seguida por uma camada de max pooling. A primeira camada convolucional tem 32 filtros e a segunda tem 64 filtros. Ambas as camadas usam a fun√ß√£o de ativa√ß√£o ReLU para introduzir n√£o linearidade.

2. **Camada de Reshaping:** Ap√≥s as camadas convolucionais, os mapas de caracter√≠sticas s√£o remodelados para uma forma adequada antes de serem passados para as camadas RNN. Isso √© feito para garantir que as dimens√µes dos dados de entrada sejam compat√≠veis com as expectativas das camadas RNN subsequentes.

3. **Camadas LSTM Bidirecionais:** Em seguida, duas camadas bidirecionais de Long Short-Term Memory (LSTM) s√£o empilhadas. A camada LSTM inicial tem 128 unidades, seguida por uma camada LSTM com 64 unidades. Ambas as camadas t√™m dropout aplicado para evitar o overfitting.

4. **Camada de Sa√≠da:** A sa√≠da das camadas LSTM √© passada para uma camada densa com ativa√ß√£o softmax para realizar a classifica√ß√£o dos caracteres. O n√∫mero de unidades na camada de sa√≠da √© determinado pelo n√∫mero de classes de caracteres presentes nos dados de treinamento, mais uma unidade adicional para lidar com os espa√ßos em branco (utilizados para o mecanismo de previs√£o CTC).

## Treinamento do Modelo

O modelo √© treinado usando o algoritmo de otimiza√ß√£o Adam e a fun√ß√£o de perda Connectionist Temporal Classification (CTC). Aqui est√£o os detalhes do treinamento:

- N√∫mero de √©pocas: 100
- Tamanho do lote: None

## Avalia√ß√£o do Modelo

Ap√≥s o treinamento, o modelo √© avaliado usando o conjunto de teste e as m√©tricas de perda e precis√£o s√£o registradas.

## Resultados

A precis√£o do modelo no conjunto de teste √© registrada como `Test accuracy: 0.9903846153846154` ou seja 99% de precis√£o.

## API de Reconhecimento de Captchas

Este √© um exemplo b√°sico de API desenvolvida usando FastAPI para reconhecimento de captchas. Ela utiliza um modelo treinado para prever a solu√ß√£o de captchas fornecidos como imagens.

## Requisitos

Certifique-se de ter Python 3.10.9 instalado em seu sistema.

## Instala√ß√£o

### Vers√£o do Python

`python==3.10.9`

### Clone este reposit√≥rio em sua m√°quina local

`git clone https://github.com/joaopalmeidao/ml_captcha_image.git`

### Navegue at√© o diret√≥rio do projeto

`cd ml_captcha_image`

### Instale as depend√™ncias usando pip

`pip install -r requirements.txt`

## Como Rodar

### Ap√≥s instalar as depend√™ncias, voc√™ pode iniciar o servidor da API usando o seguinte comando

`uvicorn module.server.wsgi:app --reload --port 8000 --host 0.0.0.0`

### Acesse a documenta√ß√£o da API

`http://localhost:8000/docs`
